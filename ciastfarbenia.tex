\chapter{FIXME: Vymysliet nazov}

FIXME: uvod

\begin{defn}
    Nech $G$ je graf s vrcholmi usporiadanými v postupnosti $v_1,v_2, \ldots, v_n$.
    Nech $f$ je čiastočné $L(2,1)$-farbenie množiny $S$ v grafe $G$ s rozsahom $k$. Pod pojmom \emph{charakteristika rádu $k$
    zobrazenia $f$} budeme rozumieť reťazec $r \in \{0, 1, \bar{1}\}^n$, ktorý spĺňa:
    \begin{align*}
        r_i = 0 & \Leftrightarrow v_i \notin S \\
        r_i = 1 & \Leftrightarrow v_i \in S \wedge f(v_i) \neq k \\
        r_i = \bar{1} & \Leftrightarrow v_i \in S \wedge f(v_i) = k
    \end{align*}

    Ďalej pod pojmom \emph{rozšírená charakteristika rádu $k$ zobrazenia $f$} budeme rozumieť reťazec
    $s \in \{0, \bar{0}, 1, \bar{1}\}^n$, ktorý spĺňa
    \begin{align*}
        s_i = 0 & \Leftrightarrow r_i = 0 \wedge (\forall j \in \{1 \dots n\}: v_j \in N(v_i) \Rightarrow t_j \neq 1 \\
        s_i = \bar{0} & \Leftrightarrow r_i = 0 \wedge (\exists j \in \{1 \dots n\}: v_j \in N(v_i) \wedge t_j = 1 \\
        s_i = r_i & \Leftrightarrow r_i \neq 0
    \end{align*}

    Charakteristiky čiastočných farbení budeme ďalej v texte značiť $r$.
\end{defn}

Z algoritmu Junosza-Szaniawski môžeme vidieť, že na reprezentáciu množiny čiastočných farbení
s obmedzeným rozsahom nám stačí ukladať množinu charakteristík fixného rádu. Keď nepotrebujeme
pre každý ofarbený vrchol ukladať jeho presnú farbu, môžeme si dovoliť reprezentovať aj
vrcholové separátory a použiť ich na rozdelenie problému. O presnom spôsobe a aplikácií
takéhoto rozdelenia si povieme v ďalšej časti.

Predtým si ale stručne pripomenieme lemu o hranových separátoroch z predošlej kapitoly \ref{hrsep-lema}.
Táto lema hovorí, že existencia $L(2,1)$-farbenia grafu $G$ vyplýva z existencie $L(2,1)$-farbení
komponentov grafu $G-E$ pre hranový oddeľovač $E$. Tieto farbenia musia navyše farbiť všetky vrcholy
z hranového oddeľovača a musia sa zhodovať v ich farbách.

Podobné tvrdenie platí aj pre čiastočné farbenia. V tomto prípade je podmienkou, že všetky čiastočné
farbenia farbia tú istú podmnožinu vrcholov z hranového oddeľovača a navyše im priradzujú rovnakú farbu.
Keďže ide o takmer identické tvrdenie k leme o hranových separátoroch \ref{hrsep-lema}, nebudeme
jeho presné znenie uvádzať.

\section{Rozdelenie na vrcholových separátoroch}

Základnou myšlienkou rozdelenia na vrcholových separátoroch je, že ak máme zafixované čiastočné
farbenie separátora a všetkých jeho susedov, farbenie zvyšných vrcholov v rôznych komponentoch
je nezávislé.

\begin{lema}
    Nech $S_V$ je vrcholový separátor grafu $G$, nech $G_1, G_2, \ldots G_k$ sú komponenty
    grafu $G - S_V$ a nech $H_1, H_2, \ldots, H_k$ sú grafy indukované množinami $V(G_1) \cup S_V,\ V(G_2) \cup S_V,\ \ldots,\ V(G_k) \cup S_V$.
    Nech $f$ je čiastočné $L(2,1)$-farbenie nejakej podmnožiny $S \subseteq N[S_V]$ v grafe $G$ a nech $f_1, f_2, \ldots f_k$
    sú čiastočné farbenia množín $S_1, S_2, \ldots, S_k$ v grafoch $H_1, H_2, \ldots, H_k$ (v tomto poradí), ktoré spĺňajú podmienku

    $$ \forall i \in \{1 \ldots k\},\ \forall v \in V(H_i) \cap N[S_V]: (v \in S_i \Leftrightarrow v \in S) \wedge (v \in S_i \Rightarrow f_i(v) = f(v)).$$

    Potom zobrazenie $\omega: \bigcup \limits_{i=1}^k S_i \to \mathbb{N}$ definované nasledovne:

    \[ \omega(v) =
    \begin{cases}
        f(v), & v \in S \\
        f_i(v), & v \in S_i - S
    \end{cases}
    \]

    tvorí čiastočné farbenie grafu $G$.
\end{lema}

\begin{proof}
    Dôkaz je veľmi podobný dôkazu lemy o hranových separátoroch \ref{hrsep-lema} v predošlej kapitole. Všetky
    vrcholy ofarbené vrámci jedného grafu $H_i$ nemôžu porušiť podmienku čiastočného $L(2,1)$-farbenia. Podobne
    pre dva vrcholy v $S$.
    
    Každá dvojica vrcholov, kde jeden patrí do $S_i - S$ a druhý do $S - S_i$ má vzdialenosť
    aspoň $3$, lebo cesta medzi nimi musí obsahovať aspoň jeden úsek, ktorý tvorí hrana z $S_i - S$ do $N(S)$, hrana
    z $N(S)$ do $S$ a hrana z $S$ do iného vrchola $N(S)$.

    Nakoniec každá dvojica vrcholov, kde jeden patrí do $S_i - S$ a druhý do $S_j - S$, kde $i \neq j$, musí mať tiež
    vzdialenosť aspoň $3$.
\end{proof}

Okolie jedného vrchola môže byť pomerne veľké, napríklad vo hviezdach v ňom môžu byť všetky zvyšné vrcholy.
Pri reprezentácii čiastočného farbenia cez jeho charakteristiku nám to však nevadí. Rôznych charakteristík,
ktoré môžu mať čiastočné farbenia malého separátora a jeho okolia, je malý. Horný odhad pre počet rôznych
charakteristík si zhrnieme v nasledujúcej leme.

\begin{lema}
    Nech $S$ je vrcholový separátor grafu $G$, nech $q = |S|$ a $p = |N[S]|$, nech $k \in \mathbb{N}$ je ľubovoľné
    číslo, nech $F$ je množina všetkých čiastočných farbení s rozsahom $k$, ktoré ofarbujú nejakú podmnožinu $N[S]$,
    nech $R$ je množina všetkých charakteristík rádu $k$ farbení v $F$. Potom $|R| \leq 2^p \cdot (p+1)^{q}$.
\end{lema}
\begin{proof}
    Najprv zhora odhadneme počet rôznych množín vrcholov, ktoré majú priradenú farbu $k$. Pre každý vrchol
    $v \in S$ platí, že v jeho okolí $N[v]$ je nanajvýš jeden vrchol, ktorý má farbu $k$. V opačnom prípade by totiž
    mali dva vrcholy vo vzdialenosti nanajvýš $2$ priradenú tú istú farbu. Keďže celkový počet vrcholov
    v $N[S]$ je $p$, pre každý z $q$ vrcholov separátora môžeme vybrať nanajvýš jednu z $p$ možností, alebo
    nevybrať žiadny vrchol. Preto množín vrcholov, ktoré majú priradenú farbu $k$, je nanajvýš $(p+1)^q$.

    Ďalej pre každú množinu vrcholou s farbou $k$ ostáva nanajvýš $p$ vrcholov, každý z nich nezávisle
    patrí, alebo nepatrí do množiny ofarbených vrcholov. Pre každú možnosť množiny vrcholov s farbou $k$
    máme teda nanajvýš $2^p$ možností, ako vyzerá množina ostatných ofarbených vrcholov. Charakteristík
    je teda nanajvýš $2^p (p+1)^q$.
\end{proof}

Rozdeľovanie pomocou vrcholového separátora budeme využívať na konštrukciu rýchlejších algoritmov
pre problém $L(2,1)$-farbenia. Pre všetky možné charakteristiky separátora a okolia si budeme pamätať,
aké charakteristiky môžu mať farbenia vo všetkých komponentoch.

Podobne bude prebiehať pridanie novej
farby. Vyskúšame pridanie všetkých farieb do separátora a jeho okolia. Pre každú takúto možnosť potom
pridáme novú farbu do každého komponentu. Ako to bude presne vyzerať s postupom a s časovou zložitosťou,
si ukážeme na príklade planárnych grafov.

\section{Farbenie planárnych grafov}

Dôležitými výsledkami pre farbenie planárnych grafov sú vety o separátoroch v planárnych grafoch \cite{tarjan_plansep},
ktoré si uvedieme.

\begin{veta}
    \label{planarsep-veta}
    Nech $G$ je planárny graf s $n$ vrcholmi. Potom sa dajú vrcholy grafu $G$ rozdeliť do troch množín $A, B, C$ tak,
    že neexistuje hrana medzi žiadnym vrcholom v $A$ a žiadnym vrcholom v $B$, množiny $A$ aj $B$ majú nanajvýš $\frac{n}{2}$
    vrcholov a množina $C$ má nanajvýš $\frac{2 \sqrt{2n}}{1 - \sqrt{\frac{2}{3}}}$ vrcholov.
\end{veta}

\begin{pozn}
Hodnota výrazu $\frac{2 \sqrt{2}}{1 - \sqrt{\frac{2}{3}}}$ je menšia ako $16$, preto budeme kvôli prehľadnosti
veľkosť množiny $C$ zhora odhadovať ako $16 \sqrt{n}$.
\end{pozn}

Ďalej budeme vytvárať algoritmus, ktorý dokáže pre danú množinu charakteristík čiastočných $L(2,1)$-farbení
s rozsahom $k$ vypočítať množinu charakteristík čiastočných $L(2,1)$-farbení s rozsahom $k+1$. Túto funkciu
nad množinami charakteristík budeme ďalej označovať $\oplus$. Pre množinu charakteristík $R$ zadefinujeme
množinu suffixov reťazca $w$ ako $R_w = \{u | wu \in R \}$.

Základný postup pri počítaní $\oplus(R)$ s využitím separátorov bude nasledovný:
Vrcholy separátora a okolia označíme $S$, počet vrcholov v $S$ označíme $p$. Vrcholy grafu usporiadame tak, aby vrcholy $S$ boli na začiatku.
Množinu (nerozšírených) charakteristík $R$ rozdelíme podľa ohodnotenia $S$. Pre každú možnosť ohodnotenia separátora
a všetky možnosti ohodnotenia $S$ novou farbou nezávisle vypočítame všetky charakteristiky, ktoré môže dosahovať
zvyšok vrcholov. Nakoniec tieto čiastočné výsledky pospájame a odstránime dupllikáty.
Formálny zápis výpočtu a jeho odvodenia bude vyzerať nasledovne:

$$ \oplus(R) = \bigcup \limits_{w \in R} \oplus(w) = \bigcup \limits_{w \in \{0, 1, \bar{1}\}^p} \oplus(R_w) = \bigcup \limits_{u \in \{0, 1, \bar{1}\}^p} \left(\bigcup \limits_{\substack{w \in \{0, 1, \bar{1}\}^p\\ \textrm{t.ž. } u \in \oplus(w)}} \oplus(R_w) \right)$$

Riešenie
problému $L(2,1)$ farbenia potom niekoľkokrát aplikuje tento algoritmus, až kým nebude v množine
charakteristík $C$ taká, ktorá zodpovedá $L(2,1)$-farbeniu. Keďže každý graf má triviálne farbenie
s rozsahom $2n - 2$, tento algoritmus nám zaručene stačí spustiť najviac $(2n - 2)$-krát.

Základom algoritmu bude nájsť separátor podľa vety o planárnom separátore \ref{planarsep-veta}. Tento
krok stačí vykonať iba raz, preto si môžeme dovoliť jeho hľadanie tak, že prejdeme všetkých $2^n$ podmnožín
vrcholov a pre každú v polynomiálnom čase overíme, či je dostatočne malá a či po jej odstránení bude mať
každý komponent súvislosti nanajvýš $\frac{n}{2}$ vrcholov.

Ďalej teda predpokladáme, že poznáme vrcholový separátor $S$. Podľa toho, koľko vrcholov je v okolí separátora, čiže
v $N[S]$, budeme robiť rôzne veci. Najprv rozoberieme jednoduchší prípad, kde $|N[S]| \ge \frac{3n}{4}$,
potom rozoberieme prípad $|N[S]| < \frac{3n}{4}$.

\subsection{Separátor s veľkým okolím}

Popíšeme algoritmus, ktorý pre danú množinu charakteristík $R$ rádu $k$ spočíta novú množinu charakteristík
rádu $k+1$. Základný postup sme už popísali, pre každú možnosť starej a novej charakteristiky separátora
vyskúšame pridať novú farbu zvyšným vrcholom. Separátor označíme $S$, počet vrcholov v $N[S]$ označíme $p$, počet
vrcholov $S$ označíme $q$, FIXME.

Pre ľubovoľnú charakteristiku separátora a jeho okolia existuje najviac $(p+1)^q$ možností, ktoré
vrcholy dostanú novú farbu $k+1$. Taktiež vieme všetky tieto možnosti generovať -- pre každý vrchol v separátore
vyberieme niektorý z vrcholov jeho uzavretého okolia, alebo nevyberieme v jeho okolí žiadny vrchol. Pre
každý takýto výber následne overíme, či sme nevybrali dva vrcholy vo vzdialenosti menšej, ako $3$, alebo
či nejaký vybratý vrchol nesusedí s vrcholom farby $k$.

Pre každú možnosť starej a novej charakteristiky separátora ostane nejaka množina charakteristík
zvyšných $n-p \leq \frac{n}{4}$ vrcholov, pre ktorú potrebujeme vypočítať nové charakteristiky. Tu si môžeme
dovoliť extrémne neefektívne riešenie, kde pre každú starú charakteristiku $r$ a každú podmnožinu $U$
jej neofarbených vrcholov vyskúšame, či je povolené ofarbiť všetky vrcholy $U$ farbou $k+1$. Takýmto
spôsobom budeme overovať nanajvýš $4^{n-p}$ možností -- keby boli vrcholy mimo separátora nezávislé,
pre každý máme iba $4$ typy možností, v ktorých ho budeme skúšať: Neofarbený vrchol ostáva neofarbený,
neofarbený vrchol farbíme $k+1$, vrchol ofarbený farbou $k$, vrchol ofarbený inou farbou.

Overenie
jedného výberu je polynomiálne, lebo stačí pre každú dvojicu vrcholov vo vzdialenosti nanajvýš
$2$ skontrolovať, či by ich priradenie farieb neporušilo podmienky $L(2,1)$-farbenia.

Pre každú z nanajvýš $2^p (p+1)^q$ možností ofarbenia $S$ vyskúšame nanajvýš $(p+1)^q$ možností pridania
novej farby do $S$. Pre každú takúto možnosť následne vyskúšame nanajvýš $4^{n-p}$ možností pridania novej
farby do množiny charakteristík a pre každú možnosť vykonáme polynomiálne veľa práce.

Celková časová
zložitosť teda bude $O^*(2^p (p+1)^{2q} 4^{n-p})$. Z vety o separátore v planárnych grafoch \ref{planarsep-veta}
vieme, že veľkosť separátora, $q$, je nanajvýš $16\sqrt{n}$. Túto vetvu algoritmu spúšťame, keď $p \ge \frac{3n}{4}$.
Funkcia $2^p 4^{n-p}$ klesá s $p$ a teda jeho najväčšia možná hodnota pre minimálne $p = \frac{3n}{4}$ je
$2^{\frac{5n}{4}}$. Výraz $(p+1)^{2q}$ zhora odhadneme na $(n+1)^{32\sqrt{n}} \leq (2n)^{32\sqrt{n}}$.

Dosadením horných odhadov dostaneme časovú zložitosť $O^*(2^{\frac{5n}{4} + 32\sqrt{n} + 32\lg{n}\sqrt{n}}) = O^*(2.38^{n + o(n)})$.
